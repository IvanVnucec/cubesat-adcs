<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="57,1" id="srcline1"> 1</a></span><span class="line"><span class="keyword">function</span> [<span class="var type1" id="S2T4U3">qib</span>] = q_gyro(<span class="var type1" id="S3T2U6">w_b</span>, <span class="var type1" id="S4T4U7">qib_prev</span>, <span class="var type1" id="S5T3U8">dt</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="57,2" id="srcline2"> 2</a></span><span class="line"><span class="comment">% Funkcija q_gyro() procijenjuje kvaternion iz ulaznih parametara:</span></span></span>
<span class="srcline"><span class="lineno"><a href="57,3" id="srcline3"> 3</a></span><span class="line"><span class="comment">%       w_b = mjereni vektor kutne brzine u koordinatnom sustavu tijela</span></span></span>
<span class="srcline"><span class="lineno"><a href="57,4" id="srcline4"> 4</a></span><span class="line"><span class="comment">%       qib_prev = prethodno procijenjeni kvaternion     </span></span></span>
<span class="srcline"><span class="lineno"><a href="57,5" id="srcline5"> 5</a></span><span class="line"><span class="comment">%       dt = vremenski korak</span></span></span>
<span class="srcline"><span class="lineno"><a href="57,6" id="srcline6"> 6</a></span><span class="line"><span class="comment">% Funkcija q_gd() vraca:</span></span></span>
<span class="srcline"><span class="lineno"><a href="57,7" id="srcline7"> 7</a></span><span class="line"><span class="comment">%       qib = estimirani kvaternion</span></span></span>
<span class="srcline"><span class="lineno"><a href="57,8" id="srcline8"> 8</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="57,9" id="srcline9"> 9</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="57,10" id="srcline10">10</a></span><span class="line"><span class="comment">% Racunam matricu za izracun vremenske promjene kvaterniona</span></span></span>
<span class="srcline"><span class="lineno"><a href="57,11" id="srcline11">11</a></span><span class="line"><span class="mxinfo " id="T20:U5"><span class="var type1" id="S6T20U11">S_w</span> = <span class="mxinfo  sgl" id="T20:U7">[<span class="mxinfo " id="T23:U8"><span class="mxinfo  sgl" id="T3:U9">0</span>     , <span class="mxinfo  sgl" id="T3:U10">-<span class="mxinfo  sgl" id="T3:U11"><span class="var type1" id="S3T2U17">w_b</span>(<span class="mxinfo " id="T10:U13">1</span>)</span></span>, <span class="mxinfo  sgl" id="T3:U14">-<span class="mxinfo  sgl" id="T3:U15"><span class="var type1" id="S3T2U21">w_b</span>(<span class="mxinfo " id="T10:U17">2</span>)</span></span>, <span class="mxinfo  sgl" id="T3:U18">-<span class="mxinfo  sgl" id="T3:U19"><span class="var type1" id="S3T2U25">w_b</span>(<span class="mxinfo " id="T10:U21">3</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="57,12" id="srcline12">12</a></span><span class="line">       <span class="mxinfo " id="T23:U22"><span class="mxinfo  sgl" id="T3:U23"><span class="var type1" id="S3T2U29">w_b</span>(<span class="mxinfo " id="T10:U25">1</span>)</span>,  <span class="mxinfo  sgl" id="T3:U26">0</span>     ,  <span class="mxinfo  sgl" id="T3:U27"><span class="var type1" id="S3T2U33">w_b</span>(<span class="mxinfo " id="T10:U29">3</span>)</span>, <span class="mxinfo  sgl" id="T3:U30">-<span class="mxinfo  sgl" id="T3:U31"><span class="var type1" id="S3T2U37">w_b</span>(<span class="mxinfo " id="T10:U33">2</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="57,13" id="srcline13">13</a></span><span class="line">       <span class="mxinfo " id="T23:U34"><span class="mxinfo  sgl" id="T3:U35"><span class="var type1" id="S3T2U41">w_b</span>(<span class="mxinfo " id="T10:U37">2</span>)</span>, <span class="mxinfo  sgl" id="T3:U38">-<span class="mxinfo  sgl" id="T3:U39"><span class="var type1" id="S3T2U45">w_b</span>(<span class="mxinfo " id="T10:U41">3</span>)</span></span>,  <span class="mxinfo  sgl" id="T3:U42">0</span>     ,  <span class="mxinfo  sgl" id="T3:U43"><span class="var type1" id="S3T2U49">w_b</span>(<span class="mxinfo " id="T10:U45">1</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="57,14" id="srcline14">14</a></span><span class="line">       <span class="mxinfo " id="T23:U46"><span class="mxinfo  sgl" id="T3:U47"><span class="var type1" id="S3T2U53">w_b</span>(<span class="mxinfo " id="T10:U49">3</span>)</span>,  <span class="mxinfo  sgl" id="T3:U50"><span class="var type1" id="S3T2U56">w_b</span>(<span class="mxinfo " id="T10:U52">2</span>)</span>, <span class="mxinfo  sgl" id="T3:U53">-<span class="mxinfo  sgl" id="T3:U54"><span class="var type1" id="S3T2U60">w_b</span>(<span class="mxinfo " id="T10:U56">1</span>)</span></span>,  <span class="mxinfo  sgl" id="T3:U57">0</span></span>]</span></span>;  </span></span>
<span class="srcline"><span class="lineno"><a href="57,15" id="srcline15">15</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="57,16" id="srcline16">16</a></span><span class="line"><span class="comment">% Racunam vremeski promjenu (rate of change) kvaterniona iz kutne brzine</span></span></span>
<span class="srcline"><span class="lineno"><a href="57,17" id="srcline17">17</a></span><span class="line"><span class="mxinfo " id="T4:U58"><span class="var type1" id="S7T4U65">d_qib_dt</span> = <span class="mxinfo  sgl" id="T4:U60"><span class="mxinfo  sgl" id="T20:U61">0.5*<span class="var type1" id="S6T20U69">S_w</span></span>*<span class="var type1" id="S4T4U70">qib_prev</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="57,18" id="srcline18">18</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="57,19" id="srcline19">19</a></span><span class="line"><span class="comment">% Integriram (akumuliram) promjenu kvaterniona i dodajem prethodnom kvaternionu        </span></span></span>
<span class="srcline"><span class="lineno"><a href="57,20" id="srcline20">20</a></span><span class="line"><span class="mxinfo  sgl" id="T4:U64"><span class="var type1" id="S2T4U73">qib</span> = <span class="mxinfo  sgl" id="T4:U66"><span class="mxinfo  sgl" id="T4:U67"><span class="var type1" id="S5T3U76">dt</span>*<span class="var type1" id="S7T4U77">d_qib_dt</span></span> + <span class="var type1" id="S4T4U78">qib_prev</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="57,21" id="srcline21">21</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="57,22" id="srcline22">22</a></span><span class="line"><span class="comment">% Normaliziram kvaternion</span></span></span>
<span class="srcline"><span class="lineno"><a href="57,23" id="srcline23">23</a></span><span class="line"><span class="mxinfo  sgl" id="T4:U71"><span class="var type1" id="S2T4U81">qib</span> = <span class="mxinfo  sgl" id="T4:U73"><span class="var type1 sgl" id="S2T4U83">qib</span>/<span class="mxinfo  sgl" id="T3:U75">norm(<span class="var type1 sgl" id="S2T4U86">qib</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="57,24" id="srcline24">24</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="57,25" id="srcline25">25</a></span><span class="line"><span class="comment">% qib predstavlja procjenu kvaterniona u trenutnom koraku</span></span></span>
<span class="srcline"><span class="lineno"><a href="57,26" id="srcline26">26</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="57,27" id="srcline27">27</a></span><span class="line"></span></span>
</pre>
