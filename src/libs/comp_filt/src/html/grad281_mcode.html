<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="68,1" id="srcline1"> 1</a></span><span class="line"><span class="keyword">function</span> [<span class="var type1" id="S2T4U3">grad_J</span>] = grad(<span class="var type1" id="S3T2U6">a_i</span>, <span class="var type1" id="S4T2U7">m_i</span>, <span class="var type1" id="S5T2U8">e_a</span>, <span class="var type1" id="S6T2U9">e_m</span>, <span class="var type1" id="S7T4U10">qib</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="68,2" id="srcline2"> 2</a></span><span class="line"><span class="comment">% Funkcija q_gd() je iterativni estimator kvaterniona koja prima:   </span></span></span>
<span class="srcline"><span class="lineno"><a href="68,3" id="srcline3"> 3</a></span><span class="line"><span class="comment">%       a_i = mjereni vektor akceleracije u inercijalnom koordinatnom sustavu</span></span></span>
<span class="srcline"><span class="lineno"><a href="68,4" id="srcline4"> 4</a></span><span class="line"><span class="comment">%       m_i = mjereni vektor akceleracije u inercijalnom koordinatnom sustavu</span></span></span>
<span class="srcline"><span class="lineno"><a href="68,5" id="srcline5"> 5</a></span><span class="line"><span class="comment">%       e_a = vektor greške akcelerometra</span></span></span>
<span class="srcline"><span class="lineno"><a href="68,6" id="srcline6"> 6</a></span><span class="line"><span class="comment">%       e_m = vektor greške magnetometra</span></span></span>
<span class="srcline"><span class="lineno"><a href="68,7" id="srcline7"> 7</a></span><span class="line"><span class="comment">%       qib = zadani kvaternion u kojem računamo graijent</span></span></span>
<span class="srcline"><span class="lineno"><a href="68,8" id="srcline8"> 8</a></span><span class="line"><span class="comment">% Funkcija q_gd() vraca vektor koji sadrzi dva elementa:</span></span></span>
<span class="srcline"><span class="lineno"><a href="68,9" id="srcline9"> 9</a></span><span class="line"><span class="comment">%       grad_J = gradijent funkcije cilja za zadani kvaternion</span></span></span>
<span class="srcline"><span class="lineno"><a href="68,10" id="srcline10">10</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="68,11" id="srcline11">11</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="68,12" id="srcline12">12</a></span><span class="line"><span class="comment">% Inicijaliziram gradijent funkcije cilja za zadani kvaternion</span></span></span>
<span class="srcline"><span class="lineno"><a href="68,13" id="srcline13">13</a></span><span class="line"><span class="mxinfo " id="T4:U7"><span class="var type1" id="S2T4U13">grad_J</span> = <span class="mxinfo " id="T4:U9"><span class="mxinfo " id="T23:U10">[<span class="mxinfo " id="T3:U11">0</span> <span class="mxinfo " id="T3:U12">0</span> <span class="mxinfo " id="T3:U13">0</span> <span class="mxinfo " id="T3:U14">0</span>]</span>'</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="68,14" id="srcline14">14</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="68,15" id="srcline15">15</a></span><span class="line"><span class="comment">% Parcijalna derivacija rotacijske matrice Rib_gd po q1</span></span></span>
<span class="srcline"><span class="lineno"><a href="68,16" id="srcline16">16</a></span><span class="line"><span class="mxinfo  sgl" id="T27:U15"><span class="var type1" id="S8T27U23">M1</span> = <span class="mxinfo  sgl" id="T27:U17">2*<span class="mxinfo  sgl" id="T27:U18">[ <span class="mxinfo " id="T28:U19"><span class="mxinfo  sgl" id="T3:U20"><span class="var type1" id="S7T4U29">qib</span>(<span class="mxinfo " id="T10:U22">1</span>)</span>  <span class="mxinfo  sgl" id="T3:U23"><span class="var type1" id="S7T4U32">qib</span>(<span class="mxinfo " id="T10:U25">4</span>)</span> <span class="mxinfo  sgl" id="T3:U26">-<span class="mxinfo  sgl" id="T3:U27"><span class="var type1" id="S7T4U36">qib</span>(<span class="mxinfo " id="T10:U29">3</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="68,17" id="srcline17">17</a></span><span class="line">        <span class="mxinfo " id="T28:U30"><span class="mxinfo  sgl" id="T3:U31">-<span class="mxinfo  sgl" id="T3:U32"><span class="var type1" id="S7T4U41">qib</span>(<span class="mxinfo " id="T10:U34">4</span>)</span></span>  <span class="mxinfo  sgl" id="T3:U35"><span class="var type1" id="S7T4U44">qib</span>(<span class="mxinfo " id="T10:U37">1</span>)</span>  <span class="mxinfo  sgl" id="T3:U38"><span class="var type1" id="S7T4U47">qib</span>(<span class="mxinfo " id="T10:U40">2</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="68,18" id="srcline18">18</a></span><span class="line">         <span class="mxinfo " id="T28:U41"><span class="mxinfo  sgl" id="T3:U42"><span class="var type1" id="S7T4U51">qib</span>(<span class="mxinfo " id="T10:U44">3</span>)</span> <span class="mxinfo  sgl" id="T3:U45">-<span class="mxinfo  sgl" id="T3:U46"><span class="var type1" id="S7T4U55">qib</span>(<span class="mxinfo " id="T10:U48">2</span>)</span></span>  <span class="mxinfo  sgl" id="T3:U49"><span class="var type1" id="S7T4U58">qib</span>(<span class="mxinfo " id="T10:U51">1</span>)</span></span>]</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="68,19" id="srcline19">19</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="68,20" id="srcline20">20</a></span><span class="line"><span class="comment">% Parcijalna derivacija rotacijske matrice Rib_gd po q2</span></span></span>
<span class="srcline"><span class="lineno"><a href="68,21" id="srcline21">21</a></span><span class="line"><span class="mxinfo  sgl" id="T27:U52"><span class="var type1" id="S9T27U62">M2</span> = <span class="mxinfo  sgl" id="T27:U54">2*<span class="mxinfo  sgl" id="T27:U55">[ <span class="mxinfo " id="T28:U56"><span class="mxinfo  sgl" id="T3:U57"><span class="var type1" id="S7T4U68">qib</span>(<span class="mxinfo " id="T10:U59">2</span>)</span>  <span class="mxinfo  sgl" id="T3:U60"><span class="var type1" id="S7T4U71">qib</span>(<span class="mxinfo " id="T10:U62">3</span>)</span>  <span class="mxinfo  sgl" id="T3:U63"><span class="var type1" id="S7T4U74">qib</span>(<span class="mxinfo " id="T10:U65">4</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="68,22" id="srcline22">22</a></span><span class="line">         <span class="mxinfo " id="T28:U66"><span class="mxinfo  sgl" id="T3:U67"><span class="var type1" id="S7T4U78">qib</span>(<span class="mxinfo " id="T10:U69">3</span>)</span> <span class="mxinfo  sgl" id="T3:U70">-<span class="mxinfo  sgl" id="T3:U71"><span class="var type1" id="S7T4U82">qib</span>(<span class="mxinfo " id="T10:U73">2</span>)</span></span>  <span class="mxinfo  sgl" id="T3:U74"><span class="var type1" id="S7T4U85">qib</span>(<span class="mxinfo " id="T10:U76">1</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="68,23" id="srcline23">23</a></span><span class="line">         <span class="mxinfo " id="T28:U77"><span class="mxinfo  sgl" id="T3:U78"><span class="var type1" id="S7T4U89">qib</span>(<span class="mxinfo " id="T10:U80">4</span>)</span> <span class="mxinfo  sgl" id="T3:U81">-<span class="mxinfo  sgl" id="T3:U82"><span class="var type1" id="S7T4U93">qib</span>(<span class="mxinfo " id="T10:U84">1</span>)</span></span> <span class="mxinfo  sgl" id="T3:U85">-<span class="mxinfo  sgl" id="T3:U86"><span class="var type1" id="S7T4U97">qib</span>(<span class="mxinfo " id="T10:U88">2</span>)</span></span></span>]</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="68,24" id="srcline24">24</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="68,25" id="srcline25">25</a></span><span class="line"><span class="comment">% Parcijalna derivacija rotacijske matrice Rib_gd po q3</span></span></span>
<span class="srcline"><span class="lineno"><a href="68,26" id="srcline26">26</a></span><span class="line"><span class="mxinfo  sgl" id="T27:U89"><span class="var type1" id="S10T27U101">M3</span> = <span class="mxinfo  sgl" id="T27:U91">2*<span class="mxinfo  sgl" id="T27:U92">[<span class="mxinfo " id="T28:U93"><span class="mxinfo  sgl" id="T3:U94">-<span class="mxinfo  sgl" id="T3:U95"><span class="var type1" id="S7T4U108">qib</span>(<span class="mxinfo " id="T10:U97">3</span>)</span></span>  <span class="mxinfo  sgl" id="T3:U98"><span class="var type1" id="S7T4U111">qib</span>(<span class="mxinfo " id="T10:U100">2</span>)</span> <span class="mxinfo  sgl" id="T3:U101">-<span class="mxinfo  sgl" id="T3:U102"><span class="var type1" id="S7T4U115">qib</span>(<span class="mxinfo " id="T10:U104">1</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="68,27" id="srcline27">27</a></span><span class="line">         <span class="mxinfo " id="T28:U105"><span class="mxinfo  sgl" id="T3:U106"><span class="var type1" id="S7T4U119">qib</span>(<span class="mxinfo " id="T10:U108">2</span>)</span>  <span class="mxinfo  sgl" id="T3:U109"><span class="var type1" id="S7T4U122">qib</span>(<span class="mxinfo " id="T10:U111">3</span>)</span>  <span class="mxinfo  sgl" id="T3:U112"><span class="var type1" id="S7T4U125">qib</span>(<span class="mxinfo " id="T10:U114">4</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="68,28" id="srcline28">28</a></span><span class="line">         <span class="mxinfo " id="T28:U115"><span class="mxinfo  sgl" id="T3:U116"><span class="var type1" id="S7T4U129">qib</span>(<span class="mxinfo " id="T10:U118">1</span>)</span>  <span class="mxinfo  sgl" id="T3:U119"><span class="var type1" id="S7T4U132">qib</span>(<span class="mxinfo " id="T10:U121">4</span>)</span> <span class="mxinfo  sgl" id="T3:U122">-<span class="mxinfo  sgl" id="T3:U123"><span class="var type1" id="S7T4U136">qib</span>(<span class="mxinfo " id="T10:U125">3</span>)</span></span></span>]</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="68,29" id="srcline29">29</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="68,30" id="srcline30">30</a></span><span class="line"><span class="comment">% Parcijalna derivacija rotacijske matrice Rib_gd po q4</span></span></span>
<span class="srcline"><span class="lineno"><a href="68,31" id="srcline31">31</a></span><span class="line"><span class="mxinfo  sgl" id="T27:U126"><span class="var type1" id="S11T27U140">M4</span> = <span class="mxinfo  sgl" id="T27:U128">2*<span class="mxinfo  sgl" id="T27:U129">[<span class="mxinfo " id="T28:U130"><span class="mxinfo  sgl" id="T3:U131">-<span class="mxinfo  sgl" id="T3:U132"><span class="var type1" id="S7T4U147">qib</span>(<span class="mxinfo " id="T10:U134">4</span>)</span></span>  <span class="mxinfo  sgl" id="T3:U135"><span class="var type1" id="S7T4U150">qib</span>(<span class="mxinfo " id="T10:U137">1</span>)</span>  <span class="mxinfo  sgl" id="T3:U138"><span class="var type1" id="S7T4U153">qib</span>(<span class="mxinfo " id="T10:U140">2</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="68,32" id="srcline32">32</a></span><span class="line">        <span class="mxinfo " id="T28:U141"><span class="mxinfo  sgl" id="T3:U142">-<span class="mxinfo  sgl" id="T3:U143"><span class="var type1" id="S7T4U158">qib</span>(<span class="mxinfo " id="T10:U145">1</span>)</span></span> <span class="mxinfo  sgl" id="T3:U146">-<span class="mxinfo  sgl" id="T3:U147"><span class="var type1" id="S7T4U162">qib</span>(<span class="mxinfo " id="T10:U149">4</span>)</span></span>  <span class="mxinfo  sgl" id="T3:U150"><span class="var type1" id="S7T4U165">qib</span>(<span class="mxinfo " id="T10:U152">3</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="68,33" id="srcline33">33</a></span><span class="line">         <span class="mxinfo " id="T28:U153"><span class="mxinfo  sgl" id="T3:U154"><span class="var type1" id="S7T4U169">qib</span>(<span class="mxinfo " id="T10:U156">2</span>)</span>  <span class="mxinfo  sgl" id="T3:U157"><span class="var type1" id="S7T4U172">qib</span>(<span class="mxinfo " id="T10:U159">3</span>)</span>  <span class="mxinfo  sgl" id="T3:U160"><span class="var type1" id="S7T4U175">qib</span>(<span class="mxinfo " id="T10:U162">4</span>)</span></span>]</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="68,34" id="srcline34">34</a></span><span class="line">     </span></span>
<span class="srcline"><span class="lineno"><a href="68,35" id="srcline35">35</a></span><span class="line"><span class="comment">% Računam gradijent za zadani kvaternion</span></span></span>
<span class="srcline"><span class="lineno"><a href="68,36" id="srcline36">36</a></span><span class="line"><span class="mxinfo  sgl" id="T3:U163"><span class="mxinfo  sgl" id="T3:U164"><span class="var type1 sgl" id="S2T4U180">grad_J</span>(<span class="mxinfo " id="T3:U166">1</span>)</span> = <span class="mxinfo  sgl" id="T3:U167"><span class="mxinfo  sgl" id="T3:U168"><span class="mxinfo  sgl" id="T28:U169"><span class="mxinfo  sgl" id="T28:U170">2*<span class="mxinfo " id="T28:U171"><span class="var type1" id="S5T2U188">e_a</span>'</span></span>*<span class="var type1 sgl" id="S8T27U189">M1</span></span>*<span class="var type1" id="S3T2U190">a_i</span></span>  +  <span class="mxinfo  sgl" id="T3:U175"><span class="mxinfo  sgl" id="T28:U176"><span class="mxinfo  sgl" id="T28:U177">2*<span class="mxinfo " id="T28:U178"><span class="var type1" id="S6T2U196">e_m</span>'</span></span>*<span class="var type1 sgl" id="S8T27U197">M1</span></span>*<span class="var type1" id="S4T2U198">m_i</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="68,37" id="srcline37">37</a></span><span class="line"><span class="mxinfo  sgl" id="T3:U182"><span class="mxinfo  sgl" id="T3:U183"><span class="var type1 sgl" id="S2T4U202">grad_J</span>(<span class="mxinfo " id="T3:U185">2</span>)</span> = <span class="mxinfo  sgl" id="T3:U186"><span class="mxinfo  sgl" id="T3:U187"><span class="mxinfo  sgl" id="T28:U188"><span class="mxinfo  sgl" id="T28:U189">2*<span class="mxinfo " id="T28:U190"><span class="var type1" id="S5T2U210">e_a</span>'</span></span>*<span class="var type1 sgl" id="S9T27U211">M2</span></span>*<span class="var type1" id="S3T2U212">a_i</span></span>  +  <span class="mxinfo  sgl" id="T3:U194"><span class="mxinfo  sgl" id="T28:U195"><span class="mxinfo  sgl" id="T28:U196">2*<span class="mxinfo " id="T28:U197"><span class="var type1" id="S6T2U218">e_m</span>'</span></span>*<span class="var type1 sgl" id="S9T27U219">M2</span></span>*<span class="var type1" id="S4T2U220">m_i</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="68,38" id="srcline38">38</a></span><span class="line"><span class="mxinfo  sgl" id="T3:U201"><span class="mxinfo  sgl" id="T3:U202"><span class="var type1 sgl" id="S2T4U224">grad_J</span>(<span class="mxinfo " id="T3:U204">3</span>)</span> = <span class="mxinfo  sgl" id="T3:U205"><span class="mxinfo  sgl" id="T3:U206"><span class="mxinfo  sgl" id="T28:U207"><span class="mxinfo  sgl" id="T28:U208">2*<span class="mxinfo " id="T28:U209"><span class="var type1" id="S5T2U232">e_a</span>'</span></span>*<span class="var type1 sgl" id="S10T27U233">M3</span></span>*<span class="var type1" id="S3T2U234">a_i</span></span>  +  <span class="mxinfo  sgl" id="T3:U213"><span class="mxinfo  sgl" id="T28:U214"><span class="mxinfo  sgl" id="T28:U215">2*<span class="mxinfo " id="T28:U216"><span class="var type1" id="S6T2U240">e_m</span>'</span></span>*<span class="var type1 sgl" id="S10T27U241">M3</span></span>*<span class="var type1" id="S4T2U242">m_i</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="68,39" id="srcline39">39</a></span><span class="line"><span class="mxinfo  sgl" id="T3:U220"><span class="mxinfo  sgl" id="T3:U221"><span class="var type1 sgl" id="S2T4U246">grad_J</span>(<span class="mxinfo " id="T3:U223">4</span>)</span> = <span class="mxinfo  sgl" id="T3:U224"><span class="mxinfo  sgl" id="T3:U225"><span class="mxinfo  sgl" id="T28:U226"><span class="mxinfo  sgl" id="T28:U227">2*<span class="mxinfo " id="T28:U228"><span class="var type1" id="S5T2U254">e_a</span>'</span></span>*<span class="var type1 sgl" id="S11T27U255">M4</span></span>*<span class="var type1" id="S3T2U256">a_i</span></span>  +  <span class="mxinfo  sgl" id="T3:U232"><span class="mxinfo  sgl" id="T28:U233"><span class="mxinfo  sgl" id="T28:U234">2*<span class="mxinfo " id="T28:U235"><span class="var type1" id="S6T2U262">e_m</span>'</span></span>*<span class="var type1 sgl" id="S11T27U263">M4</span></span>*<span class="var type1" id="S4T2U264">m_i</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="68,40" id="srcline40">40</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="68,41" id="srcline41">41</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="68,42" id="srcline42">42</a></span><span class="line"></span></span>
</pre>
